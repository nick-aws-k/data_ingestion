AWSTemplateFormatVersion: '2010-09-09'

Resources:
  DataIngestionRole:
    Type: 'AWS::IAM::Role'
    Properties:
      RoleName: 'data-ingestion-role'
      AssumeRolePolicyDocument:
        Version: '2012-10-17'
        Statement:
          - Effect: 'Allow'
            Principal:
              Service: 'lambda.amazonaws.com'
            Action: 'sts:AssumeRole'
          - Effect: 'Allow'
            Principal:
              Service: 'glue.amazonaws.com'
            Action: 'sts:AssumeRole'
          - Effect: 'Allow'
            Principal:
              Service: 'athena.amazonaws.com'
            Action: 'sts:AssumeRole'
          - Effect: 'Allow'
            Principal:
              Service: 's3.amazonaws.com'
            Action: 'sts:AssumeRole'
          - Effect: 'Allow'
            Principal:
              Service: 'events.amazonaws.com'
            Action: 'sts:AssumeRole'
          - Effect: 'Allow'
            Principal:
              Service: 'cloudwatch.amazonaws.com'
            Action: 'sts:AssumeRole'
          - Effect: 'Allow'
            Principal:
              Service: 'sns.amazonaws.com'
            Action: 'sts:AssumeRole'
          - Effect: 'Allow'
            Principal:
              Service: 'cloudwatch.amazonaws.com'
            Action: 'sts:AssumeRole'
          - Effect: 'Allow'
            Principal:
              Service: 'rds.amazonaws.com'
            Action: 'sts:AssumeRole'
          - Effect: 'Allow'
            Principal:
              Service: 'redshift.amazonaws.com'
            Action: 'sts:AssumeRole'
          - Effect: 'Allow'
            Principal:
              Service: 'lakeformation.amazonaws.com'
            Action: 'sts:AssumeRole'		
          # Add other trusted services here

  DataIngestionRolePolicy:
    Type: 'AWS::IAM::Policy'
    DependsOn: 'DataIngestionRole'
    Properties:
      PolicyName: 'DataIngestionRolePolicy'
      Roles:
        - !Ref 'DataIngestionRole'
      PolicyDocument:
        Version: '2012-10-17'
        Statement:
          - Effect: 'Allow'
            Action: 'lambda:*'
            Resource: '*'
          - Effect: 'Allow'
            Action: 'glue:*'
            Resource: '*'
          - Effect: 'Allow'
            Action: 'athena:*'
            Resource: '*'
          - Effect: 'Allow'
            Action: 's3:*'
            Resource: '*'
          - Effect: 'Allow'
            Action: 'events:*'
            Resource: '*'
          - Effect: 'Allow'
            Action: 'cloudwatch:*'
            Resource: '*'
          - Effect: 'Allow'
            Action: 'sns:*'
            Resource: '*'
          - Effect: 'Allow'
            Action: 'rds:*'
            Resource: '*'
          - Effect: 'Allow'
            Action: 'redshift:*'
            Resource: '*'
          - Effect: 'Allow'
            Action: 'sqs:*'
            Resource: '*'
          - Effect: 'Allow'
            Action: 'lakeformation:*'
            Resource: '*'
          # Add other permissions for the specified services here
